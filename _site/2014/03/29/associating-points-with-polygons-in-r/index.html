<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.5.1 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Associating points with polygons in R - MI Regression</title>




<meta name="description" content="Some time ago I posted on how to find geographic coordinates given a list of village or city names in R. Somebody emailed me about how to do the reverse: the person had a list of villages in France along with the population in 2010, and wanted to find which administrative unit each village was located in. The problem boils down to associating points, the village coordinates, with polygons, the administrative division which they are a part of.">




<meta name="author" content="Andreas Beger">

<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="MI Regression">
<meta property="og:title" content="Associating points with polygons in R">


  <link rel="canonical" href="http://localhost:4000/2014/03/29/associating-points-with-polygons-in-r/">
  <meta property="og:url" content="http://localhost:4000/2014/03/29/associating-points-with-polygons-in-r/">



  <meta property="og:description" content="Some time ago I posted on how to find geographic coordinates given a list of village or city names in R. Somebody emailed me about how to do the reverse: the person had a list of villages in France along with the population in 2010, and wanted to find which administrative unit each village was located in. The problem boils down to associating points, the village coordinates, with polygons, the administrative division which they are a part of.">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2014-03-29T02:29:03+02:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Andreas Beger",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/andybeega","https://www.linkedin.com/in/andreas-beger-67728a36","https://plus.google.com/111153267456095139645","https://scholar.google.com/citations?user=0QX5DXoAAAAJ"]
    }
  </script>



  <meta name="google-site-verification" content="cuymuwKhb4ZRPa4fX0BANEZvI3px-I4kRwScJhVEV1I" />




<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="MI Regression Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- MathJax support (took out async) -->
<script type="text/javascript" 
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">MI Regression</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Blog archive</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/papers/">Projects & Papers</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/about/">About</a></li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="http://localhost:4000/images/mugshot2017.jpg" class="author__avatar" alt="Andreas Beger" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Andreas Beger</h3>
    
      <p class="author__bio" itemprop="description">
        Conflict forecasting, data science
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Tallinn, Estonia</span>
        </li>
      

      

      
        <li>
          <a href="mailto:adbeger+mireg@gmail.com">
            <meta itemprop="email" content="adbeger+mireg@gmail.com" />
            <i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/andybeega" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/andybega" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Associating points with polygons in R">
    <meta itemprop="description" content="Some time ago I posted on how to find geographic coordinates given a list of village or city names in R. Somebody emailed me about how to do the reverse: the person had a list of villages in France along with the population in 2010, and wanted to find which administrative unit each village was located in. The problem boils down to associating points, the village coordinates, with polygons, the administrative division which they are a part of.">
    <meta itemprop="datePublished" content="March 29, 2014">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Associating points with polygons in R
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  2 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Some time ago I posted on how to <a href="2013-08-06-finding-coordinates-for-cities-etc-with-r/">find geographic coordinates given a list of village or city names in R</a>. Somebody emailed me about how to do the reverse: the person had a list of villages in France along with the population in 2010, and wanted to find which administrative unit each village was located in. The problem boils down to associating points, the village coordinates, with polygons, the administrative division which they are a part of.</p>

<p>The village data look like this:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">foreign</span><span class="p">)</span><span class="w">  
</span><span class="n">library</span><span class="p">(</span><span class="n">gdata</span><span class="p">)</span><span class="w">  
</span><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">

</span><span class="n">munic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.xls</span><span class="p">(</span><span class="s2">"France-Population.xlsx"</span><span class="p">)</span><span class="w">  
</span><span class="n">head</span><span class="p">(</span><span class="n">munic</span><span class="p">)</span><span class="w">  
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Name</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="n">pop_2010</span><span class="w">  
</span><span class="m">1</span><span class="w"> </span><span class="n">Aast</span><span class="w"> </span><span class="m">-0.0887339</span><span class="w"> </span><span class="m">43.28919</span><span class="w"> </span><span class="m">182.5416</span><span class="w">  
</span><span class="m">2</span><span class="w"> </span><span class="n">Abainville</span><span class="w"> </span><span class="m">5.4947440</span><span class="w"> </span><span class="m">48.53057</span><span class="w"> </span><span class="m">327.2407</span><span class="w">  
</span><span class="m">3</span><span class="w"> </span><span class="n">Abancourt</span><span class="w"> </span><span class="m">1.7649060</span><span class="w"> </span><span class="m">49.69672</span><span class="w"> </span><span class="m">687.2479</span><span class="w">  
</span><span class="m">4</span><span class="w"> </span><span class="n">Abancourt</span><span class="w"> </span><span class="m">3.2127010</span><span class="w"> </span><span class="m">50.23528</span><span class="w"> </span><span class="m">448.1252</span><span class="w">  
</span><span class="m">5</span><span class="w"> </span><span class="n">Abaucourt</span><span class="w"> </span><span class="m">6.2579230</span><span class="w"> </span><span class="m">48.89637</span><span class="w"> </span><span class="m">285.9438</span><span class="w">  
</span><span class="m">6</span><span class="w"> </span><span class="n">Abaucourt</span><span class="o">-</span><span class="n">Hautecourt</span><span class="w"> </span><span class="m">5.5405000</span><span class="w"> </span><span class="m">49.19700</span><span class="w"> </span><span class="m">93.0353</span><span class="w">  
</span></code></pre>
</div>

<p>To find the administrative units in which these villages are we can use the <code class="highlighter-rouge">over()</code> function from the <code class="highlighter-rouge">sp</code> package. First, we get data on administrative boundaries from <a href="http://www.gadm.org/">GADM</a>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s2">"FRA_adm2.RData"</span><span class="p">)</span><span class="w">  
</span><span class="n">adm2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gadm</span><span class="p">;</span><span class="w"> </span><span class="n">rm</span><span class="p">(</span><span class="n">gadm</span><span class="p">)</span><span class="w">  
</span><span class="n">head</span><span class="p">(</span><span class="n">adm2</span><span class="o">@</span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NAME_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NAME_2"</span><span class="p">)])</span><span class="w">  
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>NAME_1 NAME_2  
1 Picardie Somme  
2 Haute-Normandie Eure  
3 Haute-Normandie Seine-Maritime  
4 Centre Cher  
5 Centre Eure-et-Loir  
6 Centre Indre
</code></pre>
</div>

<p>The data consist of polygons for France’s departments, and includes their names as well as the name of the region they are in in the associated data table. To match up the village coordinates with these polygons we need to also convert the village data frame to a spatial object in R:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">coordinates</span><span class="p">(</span><span class="n">munic</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lat</span><span class="w">  
</span><span class="n">proj4string</span><span class="p">(</span><span class="n">munic</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">proj4string</span><span class="p">(</span><span class="n">adm2</span><span class="p">)</span><span class="w">  
</span></code></pre>
</div>

<p>The data already include latitude and longitude columns, which we need to identify as such. The second line is about setting the projection the data are in, without which <code class="highlighter-rouge">over()</code> will throw an error. The GADM data use WGS 84, which seems to be common for global data, and so it’s probably safe to assume that the French village data are also. But this isn’t necessarily true, especially with data for a smaller geographic area, which might use a projection that works better for that specific region, e.g. a specific <a href="http://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">UTM grid zone</a>.</p>

<p>The last step is to use <code class="highlighter-rouge">over()</code> to match up points and polygons. Note that <code class="highlighter-rouge">over()</code> will work with a variety of other spatial data combinations as well.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">munic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">munic</span><span class="p">,</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">munic</span><span class="p">,</span><span class="w"> </span><span class="n">adm2</span><span class="p">))</span><span class="w">  
</span><span class="n">munic</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pop_2010"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NAME_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NAME_2"</span><span class="p">)]</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Name pop_2010 NAME_1 NAME_2  
1 Aast 182.5416 Aquitaine Pyrénées-Atlantiques  
2 Abainville 327.2407 Lorraine Meuse  
3 Abancourt 687.2479 Picardie Oise  
4 Abancourt 448.1252 Nord-Pas-de-Calais Nord  
5 Abaucourt 285.9438 Lorraine Meurthe-et-Moselle  
</code></pre>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#r" class="page__taxonomy-item" rel="tag">R</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#sp" class="page__taxonomy-item" rel="tag">sp</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#programming" class="page__taxonomy-item" rel="tag">programming</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-03-29T02:29:03+02:00">March 29, 2014</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Associating+points+with+polygons+in+R%20http%3A%2F%2Flocalhost%3A4000%2F2014%2F03%2F29%2Fassociating-points-with-polygons-in-r%2F" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2014%2F03%2F29%2Fassociating-points-with-polygons-in-r%2F" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2F2014%2F03%2F29%2Fassociating-points-with-polygons-in-r%2F" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2014%2F03%2F29%2Fassociating-points-with-polygons-in-r%2F" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/2014/01/29/quick-lookup-for-country-codes/" class="pagination--pager" title="Quick lookup for country codes
">Previous</a>
    
    
      <a href="http://localhost:4000/2014/05/23/the-thailand-coup-and-some-recent-forecasting-work/" class="pagination--pager" title="The Thailand coup and some recent forecasting work
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
    
        <h4 class="page__comments-title">Leave a Comment</h4>
        <section id="disqus_thread"></section>
      
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/andybega"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Andreas Beger. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36796505-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




  
      
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/2014/03/29/associating-points-with-polygons-in-r/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2014/03/29/associating-points-with-polygons-in-r"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://mireg.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    



  </body>
</html>
